<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Nozomi's Blue Jellyfish ğŸŒŠ</title>
    <style>
        body { font-family: sans-serif; background-color: #f0f8ff; color: #4682b4; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; background: #fff; padding: 15px 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(162,210,255,0.2); }
        .main-content { display: flex; gap: 20px; }
        .pool-section { flex: 1.2; background: white; padding: 20px; border-radius: 15px; max-height: 85vh; overflow-y: auto; }
        .result-section { flex: 2; background: #e1f0ff; padding: 20px; border-radius: 15px; max-height: 85vh; overflow-y: auto; }
        .character-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 8px; margin-top: 15px; }
        .char-item { padding: 6px; background: #fff; border: 1px solid #bde0fe; border-radius: 8px; text-align: center; cursor: pointer; font-size: 12px; transition: 0.2s; }
        .char-item:hover { transform: translateY(-2px); border-color: #a2d2ff; }
        .group-card { background: #fff; padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 5px solid #a2d2ff; }
        .slots-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .slot { height: 30px; background: #f8fbfe; border: 1px dashed #d0e4f5; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 11px; color: #a2d2ff; }
        .slot.filled { background: #a2d2ff; color: white; border-style: solid; font-weight: bold; cursor: pointer; }
        button { background-color: #a2d2ff; color: white; border: none; padding: 10px 18px; border-radius: 15px; cursor: pointer; font-weight: bold; }
        .btn-save { background-color: #4682b4; }
    </style>
</head>
<body>

<div class="header">
    <h2 style="margin:0">Nozomi's Smart Groups ğŸŒŠ</h2>
    <div style="display:flex; gap:10px;">
        <button class="btn-save" onclick="save()">ğŸ’¾ å­˜æ¡£è¿›åº¦</button>
        <button onclick="share()">ğŸ”— åˆ†äº«åˆ†ç»„</button>
        <button onclick="reset()" style="background:#ccc;">æ¸…ç©º</button>
    </div>
</div>

<div class="main-content">
    <div class="pool-section">
        <h3>è§’è‰²æ± </h3>
        <div class="character-grid" id="charPool"></div>
    </div>
    <div class="result-section" id="groupsContainer"></div>
</div>

<script>
    const chars = ["å¤©ç¥¥é™¢è‹±æ™º", "æ—¥æ—¥æ ‘æ¶‰", "å§¬å®«æ¡ƒæ", "ä¼è§å¼“å¼¦", "å†°é¹°åŒ—æ–—", "æ˜æ˜Ÿæ˜´æµ", "æ¸¸æœ¨çœŸ", "è¡£æ›´çœŸç»ª", "å®ˆæ³½åƒç§‹", "æ·±æµ·å¥æ±°", "å—äº‘é“è™", "é«˜å³¯ç¿ ", "ä»™çŸ³å¿", "å¤©åŸä¸€å½©", "ç™½é¸Ÿè“è‰¯", "ç¤¼æ¿‘çœŸå®µ", "é£æ—©å·½", "ä¹±å‡ªç ‚", "å·´æ—¥å’Œ", "ä¸ƒç§èŒ¨", "æ¶Ÿçº¯", "æ–‹å®«å®—", "å½±ç‰‡ç¾ä¼½", "è‘µæ—¥å‘", "è‘µè£•å¤ª", "å¤©åŸç£·éŸ³", "HiMERU", "æ¨±æ²³ç¥ç€", "æ¤åä¸¹å¸Œ", "å¤§ç¥æ™ƒç‰™", "æœ”é—´é›¶", "ç¾½é£è–°", "ä¹™ç‹©é˜¿å¤šå°¼æ–¯", "çœŸç™½å‹ä¹Ÿ", "ä»å…”æˆé¸£", "å¤©æ»¡å…‰", "ç´«ä¹‹åˆ›", "è²å·³æ•¬äºº", "é¬¼é¾™çº¢éƒ", "ç¥å´é£’é©¬", "æœ±æ¨±å¸", "æœˆæ°¸é›·æ¬§", "æ¿‘åæ³‰", "æœ”é—´å‡›æœˆ", "é¸£ä¸Šå²š", "é€†å…ˆå¤ç›®", "é’å¶çºº", "æ˜¥å·å®™", "ä¸‰æ¯›ç¼Ÿæ–‘", "ä½è´ºç¾é˜µ", "æ¤šç« è‡£", "æ°´æœˆ"];
    let groups = [[]];

    window.onload = () => {
        const urlParams = new URLSearchParams(window.location.search);
        const data = urlParams.get('d');
        if (data) {
            try {
                // ç®€å•çš„è§£ç é€»è¾‘
                groups = JSON.parse(decodeURIComponent(escape(atob(data))));
                save(true);
            } catch(e) { load(); }
        } else { load(); }
        render();
    };

    function load() {
        const local = localStorage.getItem('nozomi_v_final');
        if (local) groups = JSON.parse(local);
    }

    function render() {
        const pool = document.getElementById('charPool');
        pool.innerHTML = '';
        chars.forEach(name => {
            const div = document.createElement('div');
            div.className = 'char-item';
            div.innerText = name;
            div.onclick = () => {
                let f = false;
                for(let g of groups){ if(g.length<12 && !g.includes(name)){ g.push(name); f=true; break; } }
                if(!f) groups.push([name]);
                render();
            };
            pool.appendChild(div);
        });

        const container = document.getElementById('groupsContainer');
        container.innerHTML = '';
        groups.forEach((group, gi) => {
            const card = document.createElement('div');
            card.className = 'group-card';
            let slots = '';
            for(let i=0; i<12; i++) {
                if(group[i]) slots += `<div class="slot filled" onclick="remove(${gi},${i})">${group[i]}</div>`;
                else slots += `<div class="slot">å¾…é€‰</div>`;
            }
            card.innerHTML = `<div style="font-weight:bold;margin-bottom:8px">ç¬¬ ${gi+1} ç»„</div><div class="slots-grid">${slots}</div>`;
            container.appendChild(card);
        });
    }

    function remove(gi, mi) { groups[gi].splice(mi, 1); render(); }

    function save(silent = false) {
        localStorage.setItem('nozomi_v_final', JSON.stringify(groups));
        if(!silent) alert("å·²å­˜å…¥æœ¬åœ°ï¼âœ¨");
    }

    function reset() { if(confirm("ç¡®å®šæ¸…ç©ºï¼Ÿ")){ groups=[[]]; localStorage.removeItem('nozomi_v_final'); render(); } }

    function share() {
        // ä½¿ç”¨ Base64 ç®€å•å‹ç¼©ä¸€ä¸‹ç½‘å€é•¿åº¦
        const data = btoa(unescape(encodeURIComponent(JSON.stringify(groups))));
        const url = window.location.origin + window.location.pathname + '?d=' + data;
        const dummy = document.createElement("textarea");
        document.body.appendChild(dummy);
        dummy.value = url;
        dummy.select();
        document.execCommand("copy");
        document.body.removeChild(dummy);
        alert("åˆ†ç»„é“¾æ¥å·²ç”Ÿæˆï¼ç›´æ¥å‘ç»™æœ‹å‹å³å¯~ ğŸ”—");
    }
</script>
</body>
</html>
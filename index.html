<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ESéšå¿ƒé…åˆ†ç»„ ğŸŒŠ</title>
    <style>
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: #f0f8ff;
            color: #4682b4;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fff;
            padding: 15px 25px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(162, 210, 255, 0.2);
        }
        .main-content { display: flex; gap: 20px; }
        .pool-section {
            flex: 1.2;
            background: white;
            padding: 20px;
            border-radius: 15px;
            max-height: 85vh;
            overflow-y: auto;
        }
        .result-section {
            flex: 2;
            background: #e1f0ff;
            padding: 20px;
            border-radius: 15px;
            max-height: 85vh;
            overflow-y: auto;
        }
        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(85px, 1fr));
            gap: 8px;
            margin-top: 15px;
        }
        .char-item {
            padding: 8px 4px;
            background: #fff;
            border: 1px solid #bde0fe;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-size: 12px;
            transition: 0.2s;
            user-select: none;
        }
        .char-item:hover { background: #e3f2fd; transform: translateY(-2px); }
        
        .group-card {
            background: #fff;
            padding: 15px;
            border-radius: 12px;
            border-left: 5px solid #a2d2ff;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(162, 210, 255, 0.1);
        }
        .slots-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .slot {
            height: 30px;
            background: #f8fbfe;
            border: 1px dashed #d0e4f5;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #a2d2ff;
        }
        .slot.filled { background: #a2d2ff; color: white; border-style: solid; font-weight: bold; cursor: pointer; }
        .slot.filled:hover { background: #ffadad; border-color: #ffadad; }

        .btn-group { display: flex; gap: 10px; }
        button {
            background-color: #a2d2ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
        }
        .save-all-btn { background-color: #4682b4; padding: 12px 25px; font-size: 14px; }
        
        #toast {
            visibility: hidden;
            background-color: #4682b4;
            color: #fff;
            text-align: center;
            border-radius: 10px;
            padding: 16px;
            position: fixed;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            z-index: 1000;
        }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {opacity: 0;} to {opacity: 1;} }
        @keyframes fadeout { from {opacity: 1;} to {opacity: 0;} }
    </style>
</head>
<body>

<div id="toast">æ‰€æœ‰è¿›åº¦å·²å­˜å…¥æœ¬åœ°å­˜æ¡£ï¼âœ¨</div>

<div class="header">
    <h2 style="margin:0">Nozomi's Multi-Jellyfish ğŸŒŠ</h2>
    <div class="btn-group">
        <button class="save-all-btn" onclick="saveData()">ğŸ’¾ ç‚¹å‡»å­˜æ¡£</button>
        <button onclick="shareData()">ğŸ”— å¤åˆ¶åˆ†äº«é“¾æ¥</button>
        <button onclick="resetData()" style="background:#ccc;">å½»åº•æ¸…ç©º</button>
    </div>
</div>

<div class="main-content">
    <div class="pool-section">
        <h3>è§’è‰²æ± </h3>
        <p style="font-size: 12px; color: #88a;">è¿ç‚¹ç›¸åŒè§’è‰²å¯è‡ªåŠ¨åˆ†é…åˆ°ä¸åŒç»„ã€‚</p>
        <div class="character-grid" id="charPool"></div>
    </div>
    
    <div class="result-section">
        <div id="groupsContainer"></div>
        <div style="text-align: center; margin-top: 10px;">
            <button onclick="addNewGroup()" style="background:#bde0fe; color:#4682b4;">+ æ‰‹åŠ¨å¢åŠ ä¸€ç»„</button>
        </div>
    </div>
</div>

<script>
    const STORAGE_KEY = 'nozomi_jellyfish_v_final';
    const chars = ["å¤©ç¥¥é™¢è‹±æ™º", "æ—¥æ—¥æ ‘æ¶‰", "å§¬å®«æ¡ƒæ", "ä¼è§å¼“å¼¦", "å†°é¹°åŒ—æ–—", "æ˜æ˜Ÿæ˜´æµ", "æ¸¸æœ¨çœŸ", "è¡£æ›´çœŸç»ª", "å®ˆæ³½åƒç§‹", "æ·±æµ·å¥æ±°", "å—äº‘é“è™", "é«˜å³¯ç¿ ", "ä»™çŸ³å¿", "å¤©åŸä¸€å½©", "ç™½é¸Ÿè“è‰¯", "ç¤¼æ¿‘çœŸå®µ", "é£æ—©å·½", "ä¹±å‡ªç ‚", "å·´æ—¥å’Œ", "ä¸ƒç§èŒ¨", "æ¶Ÿçº¯", "æ–‹å®«å®—", "å½±ç‰‡ç¾ä¼½", "è‘µæ—¥å‘", "è‘µè£•å¤ª", "å¤©åŸç£·éŸ³", "HiMERU", "æ¨±æ²³ç¥ç€", "æ¤åä¸¹å¸Œ", "å¤§ç¥æ™ƒç‰™", "æœ”é—´é›¶", "ç¾½é£è–°", "ä¹™ç‹©é˜¿å¤šå°¼æ–¯", "çœŸç™½å‹ä¹Ÿ", "ä»å…”æˆé¸£", "å¤©æ»¡å…‰", "ç´«ä¹‹åˆ›", "è²å·³æ•¬äºº", "é¬¼é¾™çº¢éƒ", "ç¥å´é£’é©¬", "æœ±æ¨±å¸", "æœˆæ°¸é›·æ¬§", "æ¿‘åæ³‰", "æœ”é—´å‡›æœˆ", "é¸£ä¸Šå²š", "é€†å…ˆå¤ç›®", "é’å¶çºº", "æ˜¥å·å®™", "ä¸‰æ¯›ç¼Ÿæ–‘"];
    
    let groups = [[]];

    window.onload = () => {
        const urlParams = new URLSearchParams(window.location.search);
        const urlData = urlParams.get('d');

        if (urlData) {
            try {
                const parsed = JSON.parse(decodeURIComponent(escape(atob(urlData))));
                if (Array.isArray(parsed)) {
                    groups = parsed;
                    saveData(true); 
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            } catch(e) { loadData(); }
        } else {
            loadData();
        }
        render();
    };

    function loadData() {
        const local = localStorage.getItem(STORAGE_KEY);
        if (local) {
            try { groups = JSON.parse(local); } catch(e) { groups = [[]]; }
        }
    }

    function render() {
        const pool = document.getElementById('charPool');
        if(!pool) return;
        pool.innerHTML = '';
        chars.forEach(name => {
            const div = document.createElement('div');
            div.className = 'char-item';
            div.innerText = name;
            div.onclick = () => {
                let f = false;
                for(let g of groups){ if(g.length<12 && !g.includes(name)){ g.push(name); f=true; break; } }
                if(!f) groups.push([name]);
                render();
            };
            pool.appendChild(div);
        });

        const container = document.getElementById('groupsContainer');
        if(!container) return;
        container.innerHTML = '';
        groups.forEach((group, gi) => {
            const card = document.createElement('div');
            card.className = 'group-card';
            let slots = '';
            for(let i=0; i<12; i++) {
                if(group[i]) slots += `<div class="slot filled" onclick="removeMember(${gi},${i})">${group[i]}</div>`;
                else slots += `<div class="slot">å¾…é€‰</div>`;
            }
            card.innerHTML = `<div style="font-weight:bold;margin-bottom:8px">ç¬¬ ${gi+1} ç»„ (${group.length}/12)</div><div class="slots-grid">${slots}</div>`;
            container.appendChild(card);
        });
    }

    function removeMember(gi, mi) { groups[gi].splice(mi, 1); render(); }

    function addNewGroup() {
        groups.push([]);
        render();
    }

    function saveData(silent = false) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(groups));
        if(!silent) {
            const toast = document.getElementById("toast");
            toast.className = "show";
            setTimeout(() => { toast.className = ""; }, 3000);
        }
    }

    function resetData() { 
        if(confirm("ç¡®å®šæ¸…ç©ºæ‰€æœ‰æœ¬åœ°è¿›åº¦å—ï¼Ÿ")){ 
            groups=[[]]; 
            localStorage.removeItem(STORAGE_KEY); 
            render(); 
        } 
    }

    function shareData() {
        const data = btoa(unescape(encodeURIComponent(JSON.stringify(groups))));
        const url = window.location.origin + window.location.pathname + '?d=' + data;
        const dummy = document.createElement("textarea");
        document.body.appendChild(dummy);
        dummy.value = url;
        dummy.select();
        document.execCommand("copy");
        document.body.removeChild(dummy);
        alert("åŒ…å«å½“å‰è¿›åº¦çš„é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼ğŸ”—");
    }
</script>
</body>
</html>